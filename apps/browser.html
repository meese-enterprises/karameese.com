<style>
	#browserSearchbar {
		display: block;
		margin: auto;
		padding: 5px;
	}

	.urlDiv {
		white-space: nowrap;
    overflow: hidden;
    width: 100%;
    color: #666;
	}

	.searchResult img {
		overflow: hidden;
    display: inline-block;
    vertical-align: middle;
		margin-right: 0.5em;
		margin-top: -3px;
		width: 16px;
	}
</style>

<script>
	const DDG = new XMLHttpRequest();

	function search(event) {
		if (event.keyCode === 13) {
			// Search the designated query on enter key
			sendQueryToDDG(event.target.value);
		}
	}

	function sendQueryToDDG(query) {
		DDG.onreadystatechange = () => this.displayResults();

		DDG.open("GET", "/ddgSearch.php?q=" + query);
		DDG.send();
	}

	function displayResults() {
		if (DDG.readyState !== 4) return;

		const response = JSON.parse(DDG.responseText);
		console.log("Response:", response);

		const searchResults = document.createElement("div");
		searchResults.id = "searchResults";

		response.forEach((result) => {
			const resultDiv = document.createElement("div");
			resultDiv.classList.add("searchResult");

			const title = document.createElement("h3");
			title.innerText = result.title;
			resultDiv.appendChild(title);

			const urlDiv = document.createElement("div");
			urlDiv.className = "urlDiv";

			const icon = document.createElement("img");
			icon.src = result.icon;
			urlDiv.appendChild(icon);

			const url = document.createElement("a");
			url.href = result.url;
			url.innerText = result.url;
			urlDiv.appendChild(url);
			resultDiv.appendChild(urlDiv);

			const snippet = document.createElement("p");
			snippet.innerText = result.snippet;
			resultDiv.appendChild(snippet);

			searchResults.appendChild(resultDiv);
		});

		document.getElementById("searchResults").replaceWith(searchResults);
		// TODO: Give credit with a link to DuckDuckGo
	}
</script>

<input
	type="text"
	id="browserSearchbar"
	placeholder="Enter a query"
	title="Enter a query"
	onkeyup="search(event)"
/>

<div id="searchResults"></div>
