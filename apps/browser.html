<style>
	#browserSearchbar {
		display: block;
		margin: auto;
		padding: 5px;
	}

	.urlDiv {
		white-space: nowrap;
    overflow: hidden;
    width: 100%;
    color: #666;
	}

	.searchResult img {
		overflow: hidden;
    display: inline-block;
    vertical-align: middle;
		margin-right: 0.5em;
		margin-top: -3px;
		width: 16px;
	}
</style>

<script>
	const googleSearch = new XMLHttpRequest();

	function search(event) {
		if (event.keyCode === 13) {
			// Search the designated query on enter key
			sendQueryToGoogleSearch(event.target.value);
		}
	}

	function sendQueryToGoogleSearch(query) {
		googleSearch.onreadystatechange = () => this.displayResults();
		googleSearch.open("GET", "/googleSearch.php?q=" + query);
		googleSearch.send();

		// TODO: Loading bar
	}

	function displayResults() {
		if (googleSearch.readyState !== 4) return;

		const response = JSON.parse(googleSearch.responseText);
		return console.log("Parsed response:", response);

		/*const results = response.map(result => {
			const url = result.url;
			const title = result.title;
			const description = result.description;
			const thumbnail = result.thumbnail;

			return `
				<div class="searchResult">
					<a href="${url}" target="_blank">
						<img src="${thumbnail}">
						<div class="urlDiv">
							<span class="title">${title}</span>
							<span class="description">${description}</span>
						</div>
					</a>
				</div>
			`;
		});*/

		const searchResults = document.createElement("div");
		searchResults.id = "searchResults";

		response.forEach((result) => {
			const resultDiv = document.createElement("div");
			resultDiv.classList.add("searchResult");

			const title = document.createElement("h3");
			title.innerText = result.title;
			resultDiv.appendChild(title);

			const urlDiv = document.createElement("div");
			urlDiv.className = "urlDiv";

			const icon = document.createElement("img");
			icon.src = result.icon;
			urlDiv.appendChild(icon);

			const url = document.createElement("a");
			url.href = result.url;
			url.innerText = result.url;
			urlDiv.appendChild(url);
			resultDiv.appendChild(urlDiv);

			const snippet = document.createElement("p");
			snippet.innerText = result.snippet;
			resultDiv.appendChild(snippet);

			searchResults.appendChild(resultDiv);
		});

		document.getElementById("searchResults").replaceWith(searchResults);
	}
</script>

<input
	type="text"
	id="browserSearchbar"
	placeholder="Enter a query"
	title="Enter a query"
	onkeyup="search(event)"
/>

<div id="searchResults"></div>
